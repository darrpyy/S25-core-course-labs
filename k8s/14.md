# StatefulSet

## 2.

```bash
kubectl get po,sts,svc,pvc
NAME                                              READY   STATUS              RESTARTS   AGE
pod/app-python-helm-0                             1/1     Running             0          48s
pod/app-python-helm-1                             1/1     Running             0          48s
pod/app-python-helm-2                             0/1     ContainerCreating   0          2s
pod/python-app-app-python-helm-7c4d4d5d88-7m2j9   1/1     Running             0          6m38s
pod/python-app-app-python-helm-7c4d4d5d88-8dzsb   1/1     Running             0          6m39s
pod/python-app-app-python-helm-7c4d4d5d88-xsdlt   1/1     Running             0          6m37s
pod/vault-0                                       1/1     Running             0          3h13m
pod/vault-agent-injector-75f9dfc9c8-994jj         1/1     Running             0          3h13m

NAME                               READY   AGE
statefulset.apps/app-python-helm   2/3     48s
statefulset.apps/vault             1/1     3h13m

NAME                                 TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)             AGE
service/app-python-helm              ClusterIP   10.104.62.25     <none>        5000/TCP            48s
service/kubernetes                   ClusterIP   10.96.0.1        <none>        443/TCP             10h
service/python-app-app-python-helm   ClusterIP   10.100.246.3     <none>        5000/TCP            73m
service/vault                        ClusterIP   10.110.178.159   <none>        8200/TCP,8201/TCP   3h13m
service/vault-agent-injector-svc     ClusterIP   10.97.36.35      <none>        443/TCP             3h13m
service/vault-internal               ClusterIP   None             <none>        8200/TCP,8201/TCP   3h13m

NAME                                                          STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
persistentvolumeclaim/app-python-visits-v-app-python-helm-0   Bound    pvc-1ac917c9-4769-4e46-a259-3a022bdea954   1Gi        RWO            standard       <unset>                 5m55s
persistentvolumeclaim/app-python-visits-v-app-python-helm-1   Bound    pvc-b652c771-ce54-4b12-9b62-83f7b43586cf   1Gi        RWO            standard       <unset>                 5m55s
persistentvolumeclaim/app-python-visits-v-app-python-helm-2   Bound    pvc-bc65c9bc-31c2-4fa4-bf6f-b0d66a38dd40   1Gi        RWO            standard       <unset>                 5m55s
```

```bash
kubectl exec pods/app-python-helm-0 -- cat visits/visits.txt && echo && kubectl exec pods/app-python-helm-1 -- cat visits/visits.txt && echo && kubectl exec pods/app-python-helm-2 -- cat visits/visits.txt
43
44
34
```

As we can see every pod has his own storage

```bash
kubectl delete pod app-python-helm-1
pod "app-python-helm-1" deleted
```

```bash
kubectl get pvc
NAME                                    STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
app-python-visits-v-app-python-helm-0   Bound    pvc-1ac917c9-4769-4e46-a259-3a022bdea954   1Gi        RWO            standard       <unset>                 11m
app-python-visits-v-app-python-helm-1   Bound    pvc-b652c771-ce54-4b12-9b62-83f7b43586cf   1Gi        RWO            standard       <unset>                 11m
app-python-visits-v-app-python-helm-2   Bound    pvc-bc65c9bc-31c2-4fa4-bf6f-b0d66a38dd40   1Gi        RWO            standard       <unset>                 11m
```

```bash
kubectl exec pods/app-python-helm-1 -- cat visits/visits.txt
78
```

As we can see, storage is persistent

```bash
kubectl apply -f https://k8s.io/examples/admin/dns/dnsutils.yaml
pod/dnsutils created

kubectl get pods dnsutils
NAME       READY   STATUS              RESTARTS   AGE
dnsutils   0/1     ContainerCreating   0          3s
```

```bash
kubectl exec -it dnsutils -- nslookup app-python-helm-0.app-python-helm.default.svc.cluster.local
Server:         10.96.0.10
Address:        10.96.0.10#53

Name:   app-python-helm-0.app-python-helm.default.svc.cluster.local
Address: 10.244.0.129
```

```bash
kubectl exec -it dnsutils -- nslookup app-python-helm-1.app-python-helm.default.svc.cluster.local
Server:         10.96.0.10
Address:        10.96.0.10#53

Name:   app-python-helm-1.app-python-helm.default.svc.cluster.local
Address: 10.244.0.130
```

Liveness and readiness:

```yaml
livenessProbe:
  httpGet:
    path: /
    port: http
readinessProbe:
  httpGet:
    path: /
    port: http
```

Kubernetes uses probes to check pod health and readiness by sending HTTP requests to defined endpoints.

- Liveness probes restart pods that become unhealthy.
- Readiness probes prevent traffic from reaching pods that aren’t ready.

These checks are especially important for stateful applications,
as they help maintain availability and reliability by ensuring only healthy pods serve traffic.

In this application, strict ordering between pods isn’t needed.
Each pod is stateful, uses its own storage, and operates independently,
so operations can proceed in parallel without coordination or dependencies.
